<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Airport Code Explorer</title>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
    }
    
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0f172a;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 9999;
    }
    
    #loading h1 {
      color: white;
      margin-bottom: 20px;
    }
    
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #334155;
      border-top-color: #60a5fa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    #app {
      display: none;
    }
    
    #app.ready {
      display: block;
    }
    
    #header {
      background: #1e293b;
      padding: 20px;
      border-bottom: 2px solid #334155;
    }
    
    #header h1 {
      font-size: 24px;
      margin-bottom: 15px;
    }
    
    #controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    
    input, select, button {
      padding: 10px 15px;
      background: #334155;
      border: 1px solid #475569;
      border-radius: 8px;
      color: white;
      font-size: 14px;
    }
    
    input {
      flex: 1;
      min-width: 200px;
    }
    
    button {
      cursor: pointer;
    }
    
    button:hover {
      background: #475569;
    }
    
    #map {
      width: 100%;
      height: calc(100vh - 120px);
    }
    
    .info-card {
      position: absolute;
      top: 20px;
      right: 20px;
      background: #1e293b;
      border: 2px solid #3b82f6;
      border-radius: 12px;
      padding: 20px;
      max-width: 320px;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    
    .info-card h2 {
      color: #3b82f6;
      font-size: 32px;
      margin-bottom: 5px;
    }
    
    .info-card .label {
      color: #94a3b8;
      font-size: 12px;
      margin-top: 12px;
      margin-bottom: 4px;
    }
    
    .info-card .value {
      font-size: 14px;
    }
    
    .close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #94a3b8;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
    }
    
    .close-btn:hover {
      color: white;
    }
    
    .legend {
      position: absolute;
      bottom: 20px;
      left: 20px;
      background: #1e293b;
      border-radius: 12px;
      padding: 15px;
      z-index: 1000;
      font-size: 14px;
    }
    
    .legend-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
    }
    
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading">
    <h1>üõ´ Airport Code Explorer</h1>
    <div class="spinner"></div>
    <p style="margin-top: 20px;">Loading map data...</p>
  </div>

  <!-- Main App -->
  <div id="app">
    <div id="header">
      <h1>‚úàÔ∏è Airport Code Explorer</h1>
      <div id="controls">
        <input type="text" id="search" placeholder="Search airports...">
        <select id="region">
          <option value="all">All Regions</option>
          <option value="americas">Americas</option>
          <option value="europe">Europe</option>
          <option value="asia">Asia</option>
          <option value="africa">Africa</option>
          <option value="oceania">Oceania</option>
        </select>
        <button id="styleBtn">Change Map Style</button>
      </div>
    </div>
    <div id="map"></div>
    <div class="legend">
      <div class="legend-title">Airport Legend</div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #f97316;"></div>
        <span>Americas</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #10b981;"></div>
        <span>Europe</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #ec4899;"></div>
        <span>Asia</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #eab308;"></div>
        <span>Africa</span>
      </div>
      <div class="legend-item">
        <div class="legend-dot" style="background: #8b5cf6;"></div>
        <span>Oceania</span>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <script>
    console.log('Script starting...');
    
    const airports = [
      { code: 'JFK', name: 'John F. Kennedy', city: 'New York', country: 'USA', lat: 40.6413, lng: -73.7781, region: 'americas' },
      { code: 'LAX', name: 'Los Angeles Intl', city: 'Los Angeles', country: 'USA', lat: 33.9416, lng: -118.4085, region: 'americas' },
      { code: 'LHR', name: 'London Heathrow', city: 'London', country: 'UK', lat: 51.4700, lng: -0.4543, region: 'europe' },
      { code: 'CDG', name: 'Charles de Gaulle', city: 'Paris', country: 'France', lat: 49.0097, lng: 2.5479, region: 'europe' },
      { code: 'DXB', name: 'Dubai International', city: 'Dubai', country: 'UAE', lat: 25.2532, lng: 55.3657, region: 'asia' },
      { code: 'NRT', name: 'Narita', city: 'Tokyo', country: 'Japan', lat: 35.7720, lng: 140.3929, region: 'asia' },
      { code: 'SYD', name: 'Sydney Airport', city: 'Sydney', country: 'Australia', lat: -33.9399, lng: 151.1753, region: 'oceania' },
      { code: 'SIN', name: 'Singapore Changi', city: 'Singapore', country: 'Singapore', lat: 1.3644, lng: 103.9915, region: 'asia' },
      { code: 'HKG', name: 'Hong Kong Intl', city: 'Hong Kong', country: 'China', lat: 22.3080, lng: 113.9185, region: 'asia' },
      { code: 'FRA', name: 'Frankfurt', city: 'Frankfurt', country: 'Germany', lat: 50.0379, lng: 8.5622, region: 'europe' },
      { code: 'ORD', name: "O'Hare", city: 'Chicago', country: 'USA', lat: 41.9742, lng: -87.9073, region: 'americas' },
      { code: 'GRU', name: 'S√£o Paulo', city: 'S√£o Paulo', country: 'Brazil', lat: -23.4356, lng: -46.4731, region: 'americas' },
      { code: 'JNB', name: 'Johannesburg', city: 'Johannesburg', country: 'South Africa', lat: -26.1392, lng: 28.2460, region: 'africa' },
      { code: 'CAI', name: 'Cairo', city: 'Cairo', country: 'Egypt', lat: 30.1219, lng: 31.4056, region: 'africa' },
    ];

    const colors = {
      americas: '#f97316',
      europe: '#10b981',
      asia: '#ec4899',
      africa: '#eab308',
      oceania: '#8b5cf6'
    };

    let map, markers = [], filter = 'all', style = 'streets', selected = null;

    function init() {
      console.log('Initializing...');
      
      // Hide loading, show app
      document.getElementById('loading').style.display = 'none';
      document.getElementById('app').classList.add('ready');
      
      // Create map
      map = L.map('map').setView([20, 0], 2);
      console.log('Map created');
      
      updateStyle();
      renderMarkers();
      
      // Event listeners
      document.getElementById('search').addEventListener('input', renderMarkers);
      document.getElementById('region').addEventListener('change', (e) => {
        filter = e.target.value;
        renderMarkers();
      });
      document.getElementById('styleBtn').addEventListener('click', () => {
        style = style === 'streets' ? 'dark' : style === 'dark' ? 'satellite' : 'streets';
        updateStyle();
      });
      
      console.log('App ready!');
    }

    function updateStyle() {
      if (map.tileLayer) map.removeLayer(map.tileLayer);
      
      const urls = {
        streets: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
        dark: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
        satellite: 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'
      };
      
      map.tileLayer = L.tileLayer(urls[style], { maxZoom: 19 }).addTo(map);
    }

    function renderMarkers() {
      markers.forEach(m => map.removeLayer(m));
      markers = [];
      
      const search = document.getElementById('search').value.toLowerCase();
      const filtered = airports.filter(a => {
        const matchSearch = a.code.toLowerCase().includes(search) ||
                           a.city.toLowerCase().includes(search) ||
                           a.country.toLowerCase().includes(search);
        const matchRegion = filter === 'all' || a.region === filter;
        return matchSearch && matchRegion;
      });
      
      filtered.forEach(airport => {
        const color = colors[airport.region];
        const icon = L.divIcon({
          html: `<div style="width:20px;height:20px;background:${color};border:3px solid white;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.3);"></div>`,
          className: '',
          iconSize: [20, 20],
          iconAnchor: [10, 10]
        });
        
        const marker = L.marker([airport.lat, airport.lng], { icon })
          .bindTooltip(`<b>${airport.code}</b><br>${airport.city}`)
          .on('click', () => showInfo(airport))
          .addTo(map);
        
        markers.push(marker);
      });
      
      if (selected) {
        filtered.forEach(a => {
          if (a.code !== selected.code) {
            const line = L.polyline(
              [[selected.lat, selected.lng], [a.lat, a.lng]],
              { color: colors[selected.region], weight: 2, opacity: 0.4, dashArray: '5,10' }
            ).addTo(map);
            markers.push(line);
          }
        });
      }
    }

    function showInfo(airport) {
      selected = airport;
      
      const old = document.querySelector('.info-card');
      if (old) old.remove();
      
      const card = document.createElement('div');
      card.className = 'info-card';
      card.innerHTML = `
        <button class="close-btn">√ó</button>
        <h2>${airport.code}</h2>
        <div style="color:#94a3b8;font-size:12px;margin-bottom:15px;">Airport Code</div>
        <div class="label">Name</div>
        <div class="value">${airport.name}</div>
        <div class="label">City</div>
        <div class="value">${airport.city}</div>
        <div class="label">Country</div>
        <div class="value">${airport.country}</div>
        <div class="label">Region</div>
        <div class="value" style="text-transform:capitalize;">${airport.region}</div>
      `;
      
      document.body.appendChild(card);
      card.querySelector('.close-btn').onclick = () => {
        card.remove();
        selected = null;
        renderMarkers();
      };
      
      renderMarkers();
    }

    // Start when Leaflet is ready
    window.addEventListener('load', () => {
      console.log('Window loaded');
      if (typeof L !== 'undefined') {
        console.log('Leaflet found');
        setTimeout(init, 100);
      } else {
        console.error('Leaflet not loaded!');
        document.getElementById('loading').innerHTML = '<h1>Error: Map library failed to load</h1><p>Please refresh the page</p>';
      }
    });
  </script>
</body>
</html>
